import{a as _e,V as Ae}from"./form-DFwA6hGK.js";import{m as Ie,u as Fe,a as Pe}from"./VSelect-VZZmIpKC.js";import{m as De,V as Y}from"./VTextField-B9XLf_50.js";import{a4 as Re,aJ as Te,aA as Me,br as Ee,r as N,a7 as P,aK as Z,a1 as m,bs as Le,bA as Ne,w as D,b0 as ee,bR as Be,ab as $e,b as s,F as $,s as F,V as le,cW as Ke,bv as Oe,v as Ue,d6 as ze,d7 as je,d as He,cX as te,o as ae,c as We,n as B,g as qe,z as Je,b5 as Xe,i as Ge,f as Qe,A as Ye,bh as ne,bi as ue,y as Ze}from"./main-4HtaUiFJ.js";import{m as el,u as ll}from"./filter-B0Ruhm0t.js";import{f as tl}from"./forwardRefs-C-GTDzx5.js";import{u as al,t as R,V as nl,a as oe}from"./VList-BswckCF8.js";import{m as ul}from"./VImg-_vWB6Zwl.js";import{V as ol}from"./VMenu-C6o_MB5q.js";import{V as sl}from"./VCheckboxBtn-BubYvrdx.js";import{V as il}from"./VAvatar-DqZM1Z9r.js";import{V as rl}from"./VChip-C3dJwiwV.js";function cl(e,b,w){if(b==null)return e;if(Array.isArray(b))throw new Error("Multiple matches is not implemented");return typeof b=="number"&&~b?s($,null,[s("span",{class:"v-combobox__unmask"},[e.substr(0,b)]),s("span",{class:"v-combobox__mask"},[e.substr(b,w)]),s("span",{class:"v-combobox__unmask"},[e.substr(b+w)])]):e}const vl=Re({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...el({filterKeys:["title"]}),...Ie({hideNoData:!0,returnObject:!0}),...Te(De({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...ul({transition:!1})},"VCombobox"),dl=Me()({name:"VCombobox",props:vl(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,b){var X;let{emit:w,slots:t}=b;const{t:S}=Ee(),V=N(),h=P(!1),g=P(!0),K=P(!1),W=N(),q=N(),O=Z(e,"menu"),c=m({get:()=>O.value,set:l=>{var n;O.value&&!l&&((n=W.value)!=null&&n.Î¨openChildren)||(O.value=l)}}),i=P(-1);let U=!1;const se=m(()=>{var l;return(l=V.value)==null?void 0:l.color}),J=m(()=>c.value?e.closeText:e.openText),{items:ie,transformIn:re,transformOut:ce}=al(e),{textColorClasses:ve,textColorStyles:de}=Le(se),u=Z(e,"modelValue",[],l=>re(Ne(l)),l=>{const n=ce(l);return e.multiple?n:n[0]??null}),I=_e(),T=m(()=>!!(e.chips||t.chip)),y=m(()=>T.value||!!t.selection),C=P(!e.multiple&&!y.value?((X=u.value[0])==null?void 0:X.title)??"":""),v=m({get:()=>C.value,set:l=>{var n;if(C.value=l??"",!e.multiple&&!y.value&&(u.value=[R(e,l)]),l&&e.multiple&&((n=e.delimiters)!=null&&n.length)){const r=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));r.length>1&&(r.forEach(a=>{a=a.trim(),a&&x(R(e,a))}),C.value="")}l||(i.value=-1),g.value=!l}}),fe=m(()=>typeof e.counterValue=="function"?e.counterValue(u.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?u.value.length:v.value.length);D(C,l=>{U?ee(()=>U=!1):h.value&&!c.value&&(c.value=!0),w("update:search",l)}),D(u,l=>{var n;!e.multiple&&!y.value&&(C.value=((n=l[0])==null?void 0:n.title)??"")});const{filteredItems:M,getMatches:me}=ll(e,ie,()=>g.value?"":v.value),k=m(()=>e.hideSelected?M.value.filter(l=>!u.value.some(n=>n.value===l.value)):M.value),be=m(()=>u.value.map(l=>l.value)),z=m(()=>{var n;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&v.value===((n=k.value[0])==null?void 0:n.title))&&k.value.length>0&&!g.value&&!K.value}),j=m(()=>e.hideNoData&&!k.value.length||e.readonly||(I==null?void 0:I.isReadonly.value)),H=N(),{onListScroll:he,onListKeydown:pe}=Fe(H,V);function ge(l){U=!0,e.openOnClear&&(c.value=!0)}function xe(){j.value||(c.value=!0)}function Ve(l){j.value||(h.value&&(l.preventDefault(),l.stopPropagation()),c.value=!c.value)}function ye(l){var a;if(je(l)||e.readonly||I!=null&&I.isReadonly.value)return;const n=V.value.selectionStart,r=u.value.length;if((i.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(c.value=!0),["Escape"].includes(l.key)&&(c.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(z.value&&["Enter","Tab"].includes(l.key)&&!u.value.some(o=>{let{value:p}=o;return p===k.value[0].value})&&x(M.value[0]),g.value=!0),l.key==="ArrowDown"&&z.value&&((a=H.value)==null||a.focus("next")),l.key==="Enter"&&v.value&&(x(R(e,v.value)),y.value&&(C.value="")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&y.value&&u.value.length>0&&!v.value)return x(u.value[0],!1);if(~i.value){const o=i.value;x(u.value[i.value],!1),i.value=o>=r-1?r-2:o}else l.key==="Backspace"&&!v.value&&(i.value=r-1)}if(e.multiple){if(l.key==="ArrowLeft"){if(i.value<0&&n>0)return;const o=i.value>-1?i.value-1:r-1;u.value[o]?i.value=o:(i.value=-1,V.value.setSelectionRange(v.value.length,v.value.length))}if(l.key==="ArrowRight"){if(i.value<0)return;const o=i.value+1;u.value[o]?i.value=o:(i.value=-1,V.value.setSelectionRange(0,0))}}}function Ce(){var l;h.value&&(g.value=!0,(l=V.value)==null||l.focus())}function x(l){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const r=u.value.findIndex(o=>e.valueComparator(o.value,l.value)),a=n??!~r;if(~r){const o=a?[...u.value,l]:[...u.value];o.splice(r,1),u.value=o}else a&&(u.value=[...u.value,l]);e.clearOnSelect&&(v.value="")}else{const r=n!==!1;u.value=r?[l]:[],C.value=r&&!y.value?l.title:"",ee(()=>{c.value=!1,g.value=!0})}}function ke(l){h.value=!0,setTimeout(()=>{K.value=!0})}function we(l){K.value=!1}function Se(l){(l==null||l===""&&!e.multiple&&!y.value)&&(u.value=[])}return D(h,(l,n)=>{if(!(l||l===n)&&(i.value=-1,c.value=!1,v.value)){if(e.multiple){x(R(e,v.value));return}if(!y.value)return;u.value.some(r=>{let{title:a}=r;return a===v.value})?C.value="":x(R(e,v.value))}}),D(c,()=>{if(!e.hideSelected&&c.value&&u.value.length){const l=k.value.findIndex(n=>u.value.some(r=>e.valueComparator(r.value,n.value)));Be&&window.requestAnimationFrame(()=>{var n;l>=0&&((n=q.value)==null||n.scrollToIndex(l))})}}),D(()=>e.items,(l,n)=>{c.value||h.value&&!n.length&&l.length&&(c.value=!0)}),$e(()=>{const l=!!(!e.hideNoData||k.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),n=u.value.length>0,r=Y.filterProps(e);return s(Y,F({ref:V},r,{modelValue:v.value,"onUpdate:modelValue":[a=>v.value=a,Se],focused:h.value,"onUpdate:focused":a=>h.value=a,validationValue:u.externalValue,counterValue:fe.value,dirty:n,class:["v-combobox",{"v-combobox--active-menu":c.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!y.value,"v-combobox--selecting-index":i.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:e.readonly,placeholder:n?void 0:e.placeholder,"onClick:clear":ge,"onMousedown:control":xe,onKeydown:ye}),{...t,default:()=>s($,null,[s(ol,F({ref:W,modelValue:c.value,"onUpdate:modelValue":a=>c.value=a,activator:"parent",contentClass:"v-combobox__content",disabled:j.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:Ce},e.menuProps),{default:()=>[l&&s(nl,F({ref:H,selected:be.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault(),onKeydown:pe,onFocusin:ke,onFocusout:we,onScrollPassive:he,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},e.listProps),{default:()=>{var a,o,p;return[(a=t["prepend-item"])==null?void 0:a.call(t),!k.value.length&&!e.hideNoData&&(((o=t["no-data"])==null?void 0:o.call(t))??s(oe,{title:S(e.noDataText)},null)),s(Pe,{ref:q,renderless:!0,items:k.value},{default:_=>{var Q;let{item:d,index:A,itemRef:f}=_;const G=F(d.props,{ref:f,key:A,active:z.value&&A===0?!0:void 0,onClick:()=>x(d,null)});return((Q=t.item)==null?void 0:Q.call(t,{item:d,index:A,props:G}))??s(oe,F(G,{role:"option"}),{prepend:E=>{let{isSelected:L}=E;return s($,null,[e.multiple&&!e.hideSelected?s(sl,{key:d.value,modelValue:L,ripple:!1,tabindex:"-1"},null):void 0,d.props.prependAvatar&&s(il,{image:d.props.prependAvatar},null),d.props.prependIcon&&s(le,{icon:d.props.prependIcon},null)])},title:()=>{var E,L;return g.value?d.title:cl(d.title,(E=me(d))==null?void 0:E.title,((L=v.value)==null?void 0:L.length)??0)}})}}),(p=t["append-item"])==null?void 0:p.call(t)]}})]}),u.value.map((a,o)=>{function p(f){f.stopPropagation(),f.preventDefault(),x(a,!1)}const _={"onClick:close":p,onKeydown(f){f.key!=="Enter"&&f.key!==" "||(f.preventDefault(),f.stopPropagation(),p(f))},onMousedown(f){f.preventDefault(),f.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},d=T.value?!!t.chip:!!t.selection,A=d?Ke(T.value?t.chip({item:a,index:o,props:_}):t.selection({item:a,index:o})):void 0;if(!(d&&!A))return s("div",{key:a.value,class:["v-combobox__selection",o===i.value&&["v-combobox__selection--selected",ve.value]],style:o===i.value?de.value:{}},[T.value?t.chip?s(Oe,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:a.title}}},{default:()=>[A]}):s(rl,F({key:"chip",closable:e.closableChips,size:"small",text:a.title,disabled:a.props.disabled},_),null):A??s("span",{class:"v-combobox__selection-text"},[a.title,e.multiple&&o<u.value.length-1&&s("span",{class:"v-combobox__selection-comma"},[Ue(",")])])])})]),"append-inner":function(){var _;for(var a=arguments.length,o=new Array(a),p=0;p<a;p++)o[p]=arguments[p];return s($,null,[(_=t["append-inner"])==null?void 0:_.call(t,...o),(!e.hideNoData||e.items.length)&&e.menuIcon?s(le,{class:"v-combobox__menu-icon",icon:e.menuIcon,onMousedown:Ve,onClick:ze,"aria-label":S(J.value),title:S(J.value),tabindex:"-1"},null):void 0])}})}),tl({isFocused:h,isPristine:g,menu:c,search:v,selectionIndex:i,filteredItems:M,select:x},V)}}),Sl=He({name:"AppCombobox",inheritAttrs:!1,__name:"AppCombobox",setup(e){const b=m(()=>{const t=te(),S=t.id||t.label;return S?`app-combobox-${S}-${Math.random().toString(36).slice(2,7)}`:void 0}),w=m(()=>te().label);return(t,S)=>(ae(),We("div",{class:Ze(["app-combobox flex-grow-1",t.$attrs.class])},[B(w)?(ae(),qe(Ae,{key:0,for:B(b),class:"mb-1 text-body-2",text:B(w)},null,8,["for","text"])):Je("",!0),s(dl,ne(ue({...t.$attrs,class:null,label:void 0,variant:"outlined",id:B(b),menuProps:{contentClass:["app-inner-list","app-combobox__content","v-combobox__content",t.$attrs.multiple!==void 0?"v-list-select-multiple":""]}})),Xe({_:2},[Ge(t.$slots,(V,h)=>({name:h,fn:Qe(g=>[Ye(t.$slots,h,ne(ue(g||{})))])}))]),1040)],2))}});export{dl as V,Sl as _};
